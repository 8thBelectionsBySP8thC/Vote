<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>8th C Elects - School Voting System by Swapnil Pandey</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-color: #1f4e79;
      --success-color: #28a745;
      --error-color: #dc3545;
      --warning-color: #ffc107;
      --light-bg: #f8f9fa;
      --white: #ffffff;
      --text-dark: #333333;
      --text-light: #666666;
      --border-color: #dee2e6;
      --shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    * { margin:0; padding:0; box-sizing:border-box;}
    body {
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:linear-gradient(135deg,var(--primary-color) 0%,#2980b9 100%);
      min-height:100vh; color:var(--text-dark);
    }
    .container { max-width:1200px; margin:0 auto; padding:20px;}
    .header { text-align:center; color:var(--white); margin-bottom:30px;}
    .header h1 { font-size:2.5rem; text-shadow:2px 2px 4px rgba(0,0,0,0.3);}
    .header p { font-size:1.2rem; opacity:0.9;}
    .card {
      background:var(--white);
      border-radius:15px;
      padding:30px;
      box-shadow:var(--shadow);
      margin-bottom:20px;
    }
    .login-container { max-width:400px; margin:0 auto;}
    .login-tabs {
      display:flex; margin-bottom:20px;
      border:1px solid var(--border-color);
      border-radius:10px; overflow:hidden;
    }
    .tab-button {
      flex:1; padding:15px; background:var(--light-bg);
      border:none; cursor:pointer; font-size:1rem; font-weight:600;
      transition:background 0.3s;
    }
    .tab-button.active { background:var(--primary-color); color:var(--white);}
    .form-group { margin-bottom:20px;}
    .form-label { display:block; margin-bottom:8px; font-weight:600;}
    .form-control {
      width:100%; padding:12px; border:2px solid var(--border-color);
      border-radius:8px; font-size:1rem; transition:border-color 0.3s;
    }
    .form-control:focus { outline:none; border-color:var(--primary-color);}
    .btn {
      background:var(--primary-color); color:var(--white);
      border:none; padding:12px 24px; border-radius:8px;
      font-size:1rem; font-weight:600; cursor:pointer; width:100%;
      transition:background 0.3s;
    }
    .btn:hover { background:#1a4066;}
    .btn-secondary { background:var(--text-light);}
    .btn-secondary:hover { background:#555;}
    .btn-success { background:var(--success-color);}
    .btn-success:hover { background:#218838;}
    .alert {
      padding:12px; border-radius:8px; margin-bottom:20px; font-weight:500;
    }
    .alert-success { background:#d4edda; color:#155724; border:1px solid #c3e6cb;}
    .alert-error { background:#f8d7da; color:#721c24; border:1px solid #f5c6cb;}
    .alert-warning { background:#fff3cd; color:#856404; border:1px solid #ffeeba;}
    .hidden { display:none;}
    .navigation { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;}
    .stats-grid {
      display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:16px; margin-bottom:20px;
    }
    .stat-card {
      background:var(--white); border-radius:12px;
      box-shadow:var(--shadow); padding:20px; text-align:center;
    }
    .stat-number { font-size:2rem; font-weight:800; color:var(--primary-color);}
    .stat-label { font-size:0.95rem; color:var(--text-light); margin-top:6px;}
    .parties-grid {
      display:grid; gap:20px;
      grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
    }
    .party-card {
      background:var(--white); border-radius:12px;
      box-shadow:var(--shadow); transition:transform 0.3s,box-shadow 0.3s;
      cursor:pointer; position:relative;
    }
    .party-card:hover {
      transform:translateY(-5px); box-shadow:0 8px 25px rgba(0,0,0,0.15);
    }
    .party-header { padding:20px; color:var(--white); text-align:center;}
    .party-candidates { padding:20px; background:var(--light-bg);}
    .candidate-row {
      display:flex; justify-content:space-between; align-items:center;
      margin-bottom:8px; padding-bottom:8px; border-bottom:1px solid rgba(0,0,0,0.1);
    }
    .candidate-row:last-child { border-bottom:none;}
    .candidate { font-weight:600; color:var(--text-dark);}
    .celebration {
      text-align:center; padding:30px;
      background:linear-gradient(45deg,var(--success-color),#20c997);
      color:var(--white); border-radius:15px; margin:20px 0;
    }
    .celebration h2 { font-size:2rem; margin-bottom:15px;}
    .celebration p { font-size:1.1rem; opacity:0.9;}
    .chart-container {
      background:var(--white); border-radius:10px;
      padding:20px; box-shadow:var(--shadow); height:500px;
      margin-bottom:20px;
    }
    @media (max-width:768px) {
      .header h1 { font-size:2rem;}
      .container { padding:10px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üó≥Ô∏è 8th C Elects</h1>
      <p>Official School Voting System - Class 8C Elections<br/>‚Äîby Swapnil Pandey</p>
    </div>

    <!-- Login Section -->
    <div id="loginSection" class="card login-container">
      <div class="login-tabs">
        <button id="studentTab" class="tab-button active" onclick="switchTab('student')">Student Login</button>
        <button id="adminTab" class="tab-button" onclick="switchTab('admin')">Admin Login</button>
      </div>
      <div id="alertContainer"></div>
      <!-- Student Login -->
      <div id="studentLogin">
        <form onsubmit="studentLogin(event)">
          <div class="form-group">
            <label class="form-label">Student ID</label>
            <input type="text" id="studentId" class="form-control" placeholder="8C001" required/>
          </div>
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <input type="text" id="studentName" class="form-control" placeholder="Your Name" required/>
          </div>
          <button type="submit" class="btn">Login to Vote</button>
        </form>
      </div>
      <!-- Admin Login -->
      <div id="adminLogin" class="hidden">
        <form onsubmit="adminLogin(event)">
          <div class="form-group">
            <label class="form-label">Username</label>
            <input type="text" id="adminUsername" class="form-control" required/>
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" id="adminPassword" class="form-control" required/>
          </div>
          <button type="submit" class="btn">Admin Login</button>
        </form>
      </div>
    </div>

    <!-- Voting Section -->
    <div id="votingSection" class="hidden">
      <div class="card">
        <div class="navigation">
          <div>
            <h2>Welcome, <span id="welcomeName"></span>!</h2>
            <p>Cast your vote for Class 8C Elections</p>
          </div>
          <button class="btn btn-secondary" onclick="logout()">Logout</button>
        </div>
        <div id="votingAlerts"></div>
        <div class="parties-grid" id="partiesGrid"></div>
        <button class="btn btn-success" onclick="submitVote(event)">üó≥Ô∏è Vote</button>
      </div>
    </div>

    <!-- Vote Success -->
    <div id="voteSuccessSection" class="hidden">
      <div class="celebration">
        <h2>üéâ Vote Submitted Successfully!</h2>
        <p>Thank you for participating in the Class 8C Elections.</p>
      </div>
      <button class="btn" onclick="logout()">Return to Login</button>
    </div>

    <!-- Already Voted -->
    <div id="alreadyVotedSection" class="hidden">
      <div class="card">
        <div class="alert alert-warning">
          <strong>You have already voted!</strong><br/>Thank you for your participation.
        </div>
        <button class="btn" onclick="logout()">Return to Login</button>
      </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminSection" class="hidden">
      <div class="card">
        <div class="navigation">
          <div>
            <h2>üîê Admin Dashboard</h2>
            <p>Class 8C Election Results ‚Äîby Swapnil Pandey</p>
          </div>
          <button class="btn btn-secondary" onclick="logout()">Logout</button>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="totalVotes">0</div>
            <div class="stat-label">Total Votes</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="eligibleVoters">0</div>
            <div class="stat-label">Eligible Voters</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="turnoutPercentage">0%</div>
            <div class="stat-label">Turnout</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="pendingVoters">0</div>
            <div class="stat-label">Pending</div>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="partyChart"></canvas>
        </div>
        <div id="partyBreakdown"></div>
        <button class="btn" onclick="exportResults()">Export Results</button>
      </div>
    </div>
  </div>

  <script>
    let currentUser=null, votedStudents=[], charts={};
    const partyVotes={ 'Unity':0,'Progress':0,'Action':0,'Service':0,'Innovation':0 };
    const parties={
      'Unity':{color:'#3498db',slogan:'Gender Equality'},
      'Progress':{color:'#e74c3c',slogan:'Excellence'},
      'Action':{color:'#2ecc71',slogan:'Making Happen'},
      'Service':{color:'#f39c12',slogan:'Serving Community'},
      'Innovation':{color:'#9b59b6',slogan:'Creative Solutions'}
    };

    // FIXED: Added missing comma after 'DM002': 'DEMOAC2'
    const students={
      'DM001': 'DEMOAC',
      'DM002': 'DEMOAC2',
      '8C001': 'Aarush',
      '8C002': 'Ananya Gupta',
      '8C003': 'Adarsh',
      '8C004': 'Diya Singh',
      '8C005': 'Ishaan Kumar',
      '8C006': 'Kavya Reddy',
      '8C007': 'Kiran Joshi',
      '8C008': 'Arpit Chaudhary',
      '8C009': 'Nikhil Verma',
      '8C010': 'Priya Nair',
      '8C011': 'Rahul Mishra',
      '8C012': 'Riya Das',
      '8C013': 'Rohan Sinha',
      '8C014': 'Sneha Iyer',
      '8C015': 'Tanvi Bhatt',
      '8C016': 'Varun Malhotra',
      '8C017': 'Vidya Rao',
      '8C018': 'Yash Pandey',
      '8C019': 'Zara Khan',
      '8C020': 'Aman Saxena',
      '8C021': 'Bhavika Tiwari',
      '8C022': 'Chinmay Dubey',
      '8C023': 'Deepika Jain',
      '8C024': 'Eshan Kapoor',
      '8C025': 'Fatima Ali',
      '8C026': 'Aadhav Sharma',
      '8C027': 'Ananya Gupta',
      '8C028': 'Sanjeet',
      '8C029': 'Diya Singh',
      '8C030': 'Ishaan Kumar',
      '8C031': 'Kavya Reddy',
      '8C032': 'Kiran Joshi',
      '8C033': 'Meera Agarwal',
      '8C034': 'Nikhil Verma',
      '8C035': 'Priya Nair',
      '8C036': 'Sreenitha',
      '8C037': 'Sujal',
      '8C038': 'Swapnil',
      '8C039': 'Tanaaz',
      '8C040': 'Tanvi',
      '8C041': 'Vaishnavi',
      '8C042': 'Yash',
      '8C043': 'Deepanshi',
      '8C044': 'Mokshit',
      '8C045': 'Nisarga',
      'TC001': 'Maseera B',
      'TC002': 'Usha R',
      'TC003': 'Laxmi AR',
      'TC004': 'SP Methi',
      'TC005': 'Anil KS',
      'TC006': 'Sushma J',
      'TC007': 'Tribhuvan',
      'TC008': 'Princy S'
    };

    const adminCred={user:'ECMB',pass:'Maseera@KVSAM'};

    function showAlert(id,msg,type){
      document.getElementById(id).innerHTML=`<div class="alert alert-${type}">${msg}</div>`;
      setTimeout(()=>document.getElementById(id).innerHTML='',5000);
    }
    function showSection(id){
      ['loginSection','votingSection','voteSuccessSection','alreadyVotedSection','adminSection']
        .forEach(s=>document.getElementById(s).classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }
    function switchTab(tab){
      document.getElementById('studentTab').classList.toggle('active',tab==='student');
      document.getElementById('adminTab').classList.toggle('active',tab==='admin');
      document.getElementById('studentLogin').classList.toggle('hidden',tab!=='student');
      document.getElementById('adminLogin').classList.toggle('hidden',tab!=='admin');
    }
    function loadState(){
      try{
        const s=JSON.parse(localStorage.getItem('state')||'{}');
        votedStudents=s.votedStudents||[]; Object.assign(partyVotes,s.partyVotes||{});
      }catch{}
    }
    function persistState(){
      localStorage.setItem('state',JSON.stringify({votedStudents,partyVotes}));
    }
    function studentLogin(e){
      e.preventDefault();
      const id=document.getElementById('studentId').value.trim().toUpperCase();
      const name=document.getElementById('studentName').value.trim();
      if(!students[id]||students[id].toLowerCase()!==name.toLowerCase())
        return showAlert('alertContainer','Invalid credentials','error');
      if(votedStudents.includes(id)) return showSection('alreadyVotedSection');
      currentUser=id;
      document.getElementById('welcomeName').textContent=students[id];
      renderParties(); showSection('votingSection');
    }
    function adminLogin(e){
      e.preventDefault();
      if(document.getElementById('adminUsername').value!==adminCred.user||
         document.getElementById('adminPassword').value!==adminCred.pass)
        return showAlert('alertContainer','Invalid admin credentials','error');
      showSection('adminSection'); updateAdminDashboard();
    }

    function renderParties(){
      const grid=document.getElementById('partiesGrid');
      grid.innerHTML='';
      Object.entries(parties).forEach(([k,v])=>{
        const pid=k.replace(/\W/g,'_');
        const candidates = Array.isArray(v.candidates) ? v.candidates : [];
        const card=document.createElement('div'); card.className='party-card';
        card.style.borderLeft=`5px solid ${v.color}`;
        card.innerHTML=`
          <div class="party-header" style="background: linear-gradient(135deg, ${v.color} 0%, ${v.color}CC 100%);">
            <input type="radio" name="party" id="${pid}" value="${k}" class="party-radio" style="margin-right:8px"/>
            <label for="${pid}"><h3>${k} Party</h3><p>${v.slogan}</p></label>
          </div>
          <div class="party-candidates">
            ${candidates.map(c=>`<div class="candidate-row"><span class="candidate">${c}</span></div>`).join('')}
          </div>
        `;
        // Make the whole card select the radio
        card.addEventListener('click',()=>{
          const r=card.querySelector('.party-radio');
          r.checked=true;
        });
        grid.appendChild(card);
      });
    }

    function submitVote(e){
      e.preventDefault();
      const sel=document.querySelector('input[name="party"]:checked');
      if(!sel) return showAlert('votingAlerts','Select a party','error');
      partyVotes[sel.value]++; votedStudents.push(currentUser);
      persistState(); showSection('voteSuccessSection'); setTimeout(confetti,500);
    }

    function updateAdminDashboard(){
      document.getElementById('totalVotes').textContent=votedStudents.length;
      const elig=Object.keys(students).length;
      document.getElementById('eligibleVoters').textContent=elig;
      document.getElementById('turnoutPercentage').textContent=elig?Math.round(votedStudents.length/elig*100)+'%':'0%';
      document.getElementById('pendingVoters').textContent=elig-votedStudents.length;
      renderChart(); renderBreakdown();
    }

    function renderChart(){
      const can=document.getElementById('partyChart');
      if(!can)return;
      const ctx=can.getContext('2d'); if(!ctx)return;
      if(charts.p)charts.p.destroy();
      charts.p=new Chart(ctx,{type:'doughnut',data:{
        labels:Object.keys(partyVotes),
        datasets:[{data:Object.values(partyVotes),
          backgroundColor:Object.keys(partyVotes).map(k=>parties[k].color)}]
      },options:{responsive:true,maintainAspectRatio:false}});
    }

    function renderBreakdown(){
      const cont=document.getElementById('partyBreakdown');
      const total=votedStudents.length;
      if(!total){cont.innerHTML='<p style="text-align:center;color:var(--text-light)">No votes yet</p>';return;}
      cont.innerHTML=Object.entries(partyVotes).sort((a,b)=>b[1]-a[1]).map(([k,v],i)=>
        `<div style="border-left:4px solid ${parties[k].color};padding:15px;margin-bottom:15px;background:var(--light-bg);border-radius:8px">
          <strong>#${i+1} ${k}: ${v} (${Math.round(v/total*100)}%)</strong>
        </div>`
      ).join('');
    }

    function exportResults(){
      const total=votedStudents.length;
      let txt=`Class 8C Election Results\nTotal Votes: ${total}\n`;
      Object.entries(partyVotes).sort((a,b)=>b[1]-a[1]).forEach(([k,v],i)=>{
        const pct=total?Math.round(v/total*100):0;
        txt+=`${i+1}. ${k}: ${v} (${pct}%)\n`;
      });
      const blob=new Blob([txt],{type:'text/plain'}),url=URL.createObjectURL(blob);
      const a=document.createElement('a');a.href=url;a.download='results.txt';
      document.body.appendChild(a);a.click();document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function logout(){currentUser=null;showSection('loginSection');switchTab('student');}

    function confetti(){
      ['#1f4e79','#28a745','#ffc107','#dc3545','#17a2b8'].forEach((c,i)=>{
        setTimeout(()=>{
          const d=document.createElement('div');
          d.style.position='fixed';d.style.top='-10px';d.style.left=Math.random()*innerWidth+'px';
          d.style.width=d.style.height='8px';d.style.backgroundColor=c;d.style.borderRadius='50%';
          d.style.zIndex='9999';
          document.body.appendChild(d);
          d.animate([{transform:'translateY(-10px)',opacity:1},{transform:`translateY(${innerHeight+10}px)`,opacity:0}],{duration:3000,easing:'ease-out'}).onfinish=()=>d.remove();
        },i*100);
      });
    }

    document.addEventListener('DOMContentLoaded',()=>{
      loadState(); showSection('loginSection');
    });
  </script>
</body>
</html>
